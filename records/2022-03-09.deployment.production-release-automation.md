# Production release automation

Date: 2022-03-09

## Status

**In review.**

## Context

Production deployments of the Notify product suite  [`notification-api`, `notification-admin`, `notification-document-download-api`, `notification-document-download-frontend`, `notification-documentation`] are centrally managed through the [manifest repository](https://github.com/cds-snc/notification-manifests).

The release process has been automated through the use of the CDS developed [Notify PR bot](https://github.com/cds-snc/notification-pr-bot). 

This bot will monitor for new changes to any of the products by tracking merged pull requests (PR) and will automatically prepare a new release candidate by creating a pull request against the [manifest repository](https://github.com/cds-snc/notification-manifests).

Upon approving and merging this release candidate, a new release would get deployed to production containing all new changes from the monitored repositories.

The [manifest repository](https://github.com/cds-snc/notification-manifests) is also used to manage configuration options of the Notify Kubernetes (K8s) cluster running in Amazon EKS. These changes are managed seperately from the Notify PR bot process.

### Why?

There was a misunderstanding relating to how the K8s kustimzation file was being updated, that led to the accidental deployment of changes immediately to production. This was caused by a portion of the configuration referencing a git commit and the remainder referencing files locally.

Once this was discovered, the [manifest repository](https://github.com/cds-snc/notification-manifests) release strategy was modified to use a `VERSION` file containing a tagged release where the existing github workflows would now use as the base for building a new release.

This change has resulted in the introduction of additional manual steps to release Notify products to production. Primarily, tagging a release after merging the release candidate created by the [Notify PR bot](https://github.com/cds-snc/notification-pr-bot), and then creating a new PR to update the `VERSION` file to contain a reference to that tagged release.

This document propose a solution to return to only requiring one PR approval and merge to deploy to production.
