# Scalability: increasing send rates

Date: 2023-06-27

## Status

**DRAFT**.

## Context

As Notify usage grows (and in particular as we anticipate increasing usage by PTMs) we need to increase our email and sms send rates.

## Initial Goals

We should be able to approach the rates that AWS sets.

### Email

Currently in staging and production our email limit with SES is [100 emails / second or 200K / day](https://ca-central-1.console.aws.amazon.com/ses/home?region=ca-central-1#/account). This can be raised on request. 

### SMS

Currently we are using [long codes in PinPoint](https://ca-central-1.console.aws.amazon.com/pinpoint/home?region=ca-central-1#/sms-account-settings/phoneNumbers) to send sms. Each long code can send one sms fragment / second. On staging we have one long code and on production we have 20. So our AWS limits are 1 fragment / second on staging and 20 fragments / second on production. We can request more long codes, though there is a limit (TODO: what is the limit?). Note that the limit for each short code is 100 fragments / second, so switching to short codes would substantially increase our AWS SMS send limit.

## Options

There are three basic areas that can be changed to increase our send rates:
- Notify code
- Notify infrastructure

### Notify code

We currently cannot send emails or sms to AWS fast enough to meet the rates AWS is willing to send. There are likely areas of the code that can be optimized. We should identify where the bottlenecks are in the process (for example, which queues are filling up).

Is there any way to send multiple emails (or sms) to AWS at once? If so that would likely improve our Notify -> SES boto time.

### Notify infrastructure

Our approach is already parallelized (an asyncronous task is created for each notification to be delivered). Simply running more tasks at once (ie more workers) would speed things up. This could of course create another bottleneck (we've had issues with the database in the past, for example)


## Analysis of Notify internals - email

_TODO: do the analysis

## Analysis of Notify internals - sms

_TODO: do the analysis

## Additional considerations

_TODO: Describe extras in here._

## Decision

_TODO: Describe the way forward._

## Consequences

_TODO: Describe foreseen and felt consequences of the decision (possible after 1-3 months)._
