# Malicious Content Scanning

Date: 2023-01-24

## Status

**DRAFT**.

_VALUES: (DRAFT, IN REVIEW, APPROVED, REJECTED)_

## Context

[security review suggested we should do this]
As a result of a 

[I tried getting scan-files to run on our s3 bucket, that didn't work because we are using a separate encryption key for each file to prevent a user from being able to download other people's files]

[I am now calling the scan files api directly. this can take a few seconds to return a response, and time increases as file size increases]

[I was planning to use the async library in python to create a new process to call the scan-files api. then once the result is returned, I can then write that result to the s3 object as a tag which can be read later.]

[it looks like it is not possible to use async code or create background processes inside flask, so now there are a few possible next steps.]
It seems that it is [not possible to create background processes inside flask](https://flask.palletsprojects.com/en/2.2.x/async-await/#background-tasks).

## Options

Here are some of the options for scanning email attachments with the scan-files project.

### Migrate Document Download API from Flask to Quart

Flask does not have good async support, and [they suggest using Quart for better async support](https://flask.palletsprojects.com/en/2.2.x/async-await/#when-to-use-quart-instead). 

It does seem like Quart [adds support for background tasks](https://quart.palletsprojects.com/en/latest/how_to_guides/background_tasks.html) and would solve our problem.

It seems like migrating from Flask to [Quart](https://github.com/pallets/quart) is not very difficult (see [quart docs](https://quart.palletsprojects.com/en/latest/how_to_guides/flask_migration.html)). But we would still need to make sure that this would fix the problem. 

### Duplicate S3 bucket



### Change how scan-files works 

_TODO: Describe an option._

### Implement a new queue in Document Download API to start background tasks

_TODO: Describe an option._

## Additional considerations

_TODO: Describe extras in here._

## Decision

_TODO: Describe the way forward._

## Consequences

_TODO: Describe foreseen and felt consequences of the decision (possible after 1-3 months)._
