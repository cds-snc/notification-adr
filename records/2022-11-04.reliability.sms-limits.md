# SMS Limits

Date: 2022-11-04

## Status

**DRAFT**

## Context

Currently Notify only has a "combined" email and SMS limit. 

Prompted by an incident where we had a very high and unexpected volume of SMS sends...

## Implementation overview

In order to enforce a new SMS-specific limit, we have added checks to the "front door" of the API, where the post requests come in that result in an SMS send:
- for the `/<uuid:service_id>/send-notification` endpoint used by the Admin "send one off" flow: [app/service/send_notification.py](https://github.com/cds-snc/notification-api/blob/d3412ad3697162550d3f5d73958f488a305d3cf7/app/service/send_notification.py#L66)
- for the job creation endpoint used by the Admin CSV send flow: [app/job/rest.py](https://github.com/cds-snc/notification-api/blob/d3412ad3697162550d3f5d73958f488a305d3cf7/app/job/rest.py#L149)
- for the `/bulk` API endpoint defined in [app/v2/notifications/post_notifications.py](https://github.com/cds-snc/notification-api/blob/d3412ad3697162550d3f5d73958f488a305d3cf7/app/v2/notifications/post_notifications.py#L186)
- for the `/sms` API endpoint defined in [app/v2/notifications/post_notifications.py](https://github.com/cds-snc/notification-api/blob/d3412ad3697162550d3f5d73958f488a305d3cf7/app/v2/notifications/post_notifications.py#L228)

Before arriving at this solution, we tried adding checks to other places in the API code, including celery and ...

(Placeholder for diagram)

## API implementation notes

- New SMS Limits specific emails

## Admin implementation notes

The minimum set of changes for V1. Changes include:
- An error message that is displayed in the CSV send flow
- An error message that is diplayed in the "one off" and "send to myself" send flows
- A new entry on the settings page that is visible to users: "Daily text fragments limit"

## Additional considerations

Phasing of the release of this feature is as follows:
V1: technical implementation, especially on the API side. Minimum viable UI changes.
V2: UI changes to better surface the SMS Limit to users, after usability testing occurs.

## Decision

_TODO: Describe the way forward._

## Consequences

_TODO: Describe foreseen and felt consequences of the decision (possible after 1-3 months)._
